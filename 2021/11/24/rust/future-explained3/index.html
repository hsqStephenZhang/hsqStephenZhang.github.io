<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="mem::swap(Rust, ü¶Ä )"><meta name="copyright" content="mem::swap(Rust, ü¶Ä )"><meta name="generator" content="Hexo 5.4.0"><meta name="theme" content="hexo-theme-yun"><title>future explained(3) | Hexo</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.25/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_dxory92pb0h.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/svg+xml" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"hsqstephenzhang.github.io","root":"/","title":"memswap ÁöÑÂ∞èÁ´ô","version":"1.7.0","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}.","hits":"${hits} results found","hits_time":"${hits} results found in ${time} ms"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/utils.js"></script><script src="/js/hexo-theme-yun.js"></script><meta name="description" content="future explained(3)  ‚Äì Pin ÂøÉË∑ØÂéÜÁ®ãwithoutboats ÊòØ Rust ÂºÇÊ≠•ÁöÑ‰∏ªË¶ÅË¥üË¥£‰∫∫Ôºå‰ªñÂú®‰∏ÄÊ¨°ÂàÜ‰∫´‰∏≠ËØ¶ÁªÜÊèèËø∞‰∫Ü Pin ÁöÑÊºîÂèòËøáÁ®ãÂíåËÉåÂêéÁöÑÂøÉË∑ØÂéÜÁ®ã ‰∏Ä. Future Ê®°ÂºèÂºïÂÖ•Âú® Rust ‰πãÂâçÁöÑÂæàÂ§öËØ≠Ë®ÄÔºåÁªùÂ§ßÂ§öÊï∞ÈÄâÊã©‰∫ÜÂõûË∞ÉÊú∫Âà∂ÂÆûÁé∞ÁöÑÂºÇÊ≠•ÈÄªËæëÔºåÊØîÂ¶ÇCËØ≠Ë®Ä‰∏≠ÁöÑ libeventÔºåÂÜçËøòÊúâ nodejs ‰∏≠ÁöÑ callback„ÄÇÈ¶ñÂÖàÂú® Rust ‰∏≠Ôºå‰Ω†ÂæàÈöæÂÜôÂá∫ node">
<meta property="og:type" content="article">
<meta property="og:title" content="future explained(3)">
<meta property="og:url" content="https://hsqstephenzhang.github.io/2021/11/24/rust/future-explained3/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="future explained(3)  ‚Äì Pin ÂøÉË∑ØÂéÜÁ®ãwithoutboats ÊòØ Rust ÂºÇÊ≠•ÁöÑ‰∏ªË¶ÅË¥üË¥£‰∫∫Ôºå‰ªñÂú®‰∏ÄÊ¨°ÂàÜ‰∫´‰∏≠ËØ¶ÁªÜÊèèËø∞‰∫Ü Pin ÁöÑÊºîÂèòËøáÁ®ãÂíåËÉåÂêéÁöÑÂøÉË∑ØÂéÜÁ®ã ‰∏Ä. Future Ê®°ÂºèÂºïÂÖ•Âú® Rust ‰πãÂâçÁöÑÂæàÂ§öËØ≠Ë®ÄÔºåÁªùÂ§ßÂ§öÊï∞ÈÄâÊã©‰∫ÜÂõûË∞ÉÊú∫Âà∂ÂÆûÁé∞ÁöÑÂºÇÊ≠•ÈÄªËæëÔºåÊØîÂ¶ÇCËØ≠Ë®Ä‰∏≠ÁöÑ libeventÔºåÂÜçËøòÊúâ nodejs ‰∏≠ÁöÑ callback„ÄÇÈ¶ñÂÖàÂú® Rust ‰∏≠Ôºå‰Ω†ÂæàÈöæÂÜôÂá∫ node">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://hsqstephenzhang.github.io/images/pin1.png">
<meta property="og:image" content="https://hsqstephenzhang.github.io/images/pin2.png">
<meta property="article:published_time" content="2021-11-24T06:01:29.000Z">
<meta property="article:modified_time" content="2022-01-10T07:48:20.464Z">
<meta property="article:author" content="mem::swap(Rust, ü¶Ä )">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hsqstephenzhang.github.io/images/pin1.png"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="Table of Contents"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="Overview"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="mem::swap(Rust, ü¶Ä )"><img width="96" loading="lazy" src="/yun.png" alt="mem::swap(Rust, ü¶Ä )"></a><div class="site-author-name"><a href="/about/">mem::swap(Rust, ü¶Ä )</a></div><span class="site-name">Hexo</span><sub class="site-subtitle"></sub><div class="site-desciption"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="Home"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="Archives"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">34</span></a></div><div class="site-state-item"><a href="/categories/" title="Categories"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">7</span></a></div><div class="site-state-item"><a href="/tags/" title="Tags"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">0</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="ÊñáÊ°£"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://qm.qq.com/cgi-bin/qm/qr?k=kZJzggTTCf4SpvEQ8lXWoi5ZjhAx0ILZ&amp;jump_from=webapi" title="QQ Áæ§ 1050458482" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/YunYouJun" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://weibo.com/jizhideyunyoujun" title="ÂæÆÂçö" target="_blank" style="color:#E6162D"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-weibo-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.douban.com/people/yunyoujun/" title="Ë±ÜÁì£" target="_blank" style="color:#007722"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-douban-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=247102977" title="ÁΩëÊòì‰∫ëÈü≥‰πê" target="_blank" style="color:#C20C0C"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.zhihu.com/people/yunyoujun/" title="Áü•‰πé" target="_blank" style="color:#0084FF"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-zhihu-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/1579790" title="ÂìîÂì©ÂìîÂì©" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/about/white-qrcode-and-search.jpg" title="ÂæÆ‰ø°ÂÖ¨‰ºóÂè∑" target="_blank" style="color:#1AAD19"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-2-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://twitter.com/YunYouJun" title="Twitter" target="_blank" style="color:#1da1f2"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-twitter-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://t.me/elpsycn" title="Telegram Channel" target="_blank" style="color:#0088CC"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-telegram-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:me@yunyoujun.cn" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://travellings.link" title="Travelling" target="_blank" style="color:var(--hty-text-color)"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-train-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="ÊàëÁöÑÂ∞è‰ºô‰º¥‰ª¨" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#future-explained-3-%E2%80%93-Pin-%E5%BF%83%E8%B7%AF%E5%8E%86%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text">future explained(3)  ‚Äì Pin ÂøÉË∑ØÂéÜÁ®ã</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-Future-%E6%A8%A1%E5%BC%8F%E5%BC%95%E5%85%A5"><span class="toc-number">1.1.</span> <span class="toc-text">‰∏Ä. Future Ê®°ÂºèÂºïÂÖ•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-Future-%E6%94%B9%E8%BF%9B%EF%BC%8CPin-%E5%BC%95%E5%85%A5"><span class="toc-number">1.2.</span> <span class="toc-text">‰∫å. Future ÊîπËøõÔºåPin ÂºïÂÖ•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-unsafe-%E6%A0%87%E8%AE%B0"><span class="toc-number">1.2.1.</span> <span class="toc-text">1. unsafe Ê†áËÆ∞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Pin-%E7%9A%84%E5%8E%9F%E5%A7%8B%E7%89%88%E6%9C%AC"><span class="toc-number">1.2.2.</span> <span class="toc-text">2. Pin ÁöÑÂéüÂßãÁâàÊú¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Unpin-%E7%9A%84%E5%BC%95%E5%85%A5"><span class="toc-number">1.2.3.</span> <span class="toc-text">3. Unpin ÁöÑÂºïÂÖ•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-%E5%B0%8F%E7%BB%93"><span class="toc-number">1.3.</span> <span class="toc-text">‰∏â. Â∞èÁªì</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98%EF%BC%8CHeap-or-Stack"><span class="toc-number">1.4.</span> <span class="toc-text">3.1 Á¨¨‰∏Ä‰∏™ÈóÆÈ¢òÔºåHeap or Stack?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E7%AC%AC%E4%BA%8C%E4%B8%AA%E9%97%AE%E9%A2%98%EF%BC%8C%E8%8E%B7%E5%8F%96-amp-mut-Self"><span class="toc-number">1.4.1.</span> <span class="toc-text">3.1 Á¨¨‰∫å‰∏™ÈóÆÈ¢òÔºåËé∑Âèñ &amp;mut Self</span></a></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://hsqStephenZhang.github.io/2021/11/24/rust/future-explained3/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="mem::swap(Rust, ü¶Ä )"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Hexo"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">future explained(3)</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="Created: 2021-11-24 14:01:29" itemprop="dateCreated datePublished" datetime="2021-11-24T14:01:29+08:00">2021-11-24</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <time title="Modified: 2022-01-10 15:48:20" itemprop="dateModified" datetime="2022-01-10T15:48:20+08:00">2022-01-10</time></div><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/rust-future/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">rust future</span></a></span></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><h1 id="future-explained-3-‚Äì-Pin-ÂøÉË∑ØÂéÜÁ®ã"><a href="#future-explained-3-‚Äì-Pin-ÂøÉË∑ØÂéÜÁ®ã" class="headerlink" title="future explained(3)  ‚Äì Pin ÂøÉË∑ØÂéÜÁ®ã"></a>future explained(3)  ‚Äì Pin ÂøÉË∑ØÂéÜÁ®ã</h1><p>withoutboats ÊòØ Rust ÂºÇÊ≠•ÁöÑ‰∏ªË¶ÅË¥üË¥£‰∫∫Ôºå‰ªñÂú®‰∏ÄÊ¨°ÂàÜ‰∫´‰∏≠ËØ¶ÁªÜÊèèËø∞‰∫Ü Pin ÁöÑÊºîÂèòËøáÁ®ãÂíåËÉåÂêéÁöÑÂøÉË∑ØÂéÜÁ®ã</p>
<h2 id="‰∏Ä-Future-Ê®°ÂºèÂºïÂÖ•"><a href="#‰∏Ä-Future-Ê®°ÂºèÂºïÂÖ•" class="headerlink" title="‰∏Ä. Future Ê®°ÂºèÂºïÂÖ•"></a>‰∏Ä. Future Ê®°ÂºèÂºïÂÖ•</h2><p>Âú® Rust ‰πãÂâçÁöÑÂæàÂ§öËØ≠Ë®ÄÔºåÁªùÂ§ßÂ§öÊï∞ÈÄâÊã©‰∫ÜÂõûË∞ÉÊú∫Âà∂ÂÆûÁé∞ÁöÑÂºÇÊ≠•ÈÄªËæëÔºåÊØîÂ¶ÇCËØ≠Ë®Ä‰∏≠ÁöÑ libeventÔºåÂÜçËøòÊúâ nodejs ‰∏≠ÁöÑ callback„ÄÇ<br>È¶ñÂÖàÂú® Rust ‰∏≠Ôºå‰Ω†ÂæàÈöæÂÜôÂá∫ <code>nodejs</code> ÈÇ£ÁßçÂõûË∞ÉÊ®°ÂºèÁöÑÂºÇÊ≠•‰ª£Á†ÅÔºå‰∏ãÈù¢ÊòØ‰∏ÄÂ∞èÊÆµÂÖ∏ÂûãÁöÑ <code>nodejs</code> ÂõûË∞ÉÊ®°Âûã</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">get_foos</span></span>(client: Client) -&gt; <span class="keyword">impl</span> Future&lt;Output = <span class="built_in">Vec</span>&lt;Response&gt;&gt;&#123;</span><br><span class="line">    client.get_index(<span class="string">&quot;/foos&quot;</span>).and_then(|index|&#123;</span><br><span class="line">        client.get_responses(&amp;index).collect()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Âú® Rust ‰∏≠Ôºå‰∏î‰∏çËØ¥ÂõûË∞ÉÂú∞Áã±ÈóÆÈ¢òÔºåÂÖ≥ÈîÆÊòØËøôÁßçÂÜôÊ≥ï <strong>Ê†π Êú¨ Áºñ ËØë ‰∏ç Ëøá!</strong></p>
<p>ËøôÊÆµ‰ª£Á†ÅÔºåÂú® Rust ‰∏≠Â≠òÂú®Âæà‰∏•ÈáçÁöÑÊâÄÊúâÊùÉÂíåÁîüÂëΩÂë®ÊúüÈóÆÈ¢òÔºå‰Ω†‰ºöÂæóÂà∞ÂêÑÁßçÂêÑÊ†∑ÁöÑÁºñËØëÈîôËØØ„ÄÇÊ†πÊçÆ rustc ÁöÑÊèêÁ§∫ÔºåÁºùÁºùË°•Ë°•Ôºå‰Ω†ÊàñËÆ∏‰ºöÁî®‰∏ãÈù¢ËøôÁßçÊñπÂºèÂéªÂ§ÑÁêÜÔºå‰πüÁ°ÆÂÆûÂèØ‰ª•ÁºñËØëÔºå‰ΩÜ‰πü‰ªÖÊ≠§ËÄåÂ∑≤„ÄÇ‰∏î‰∏çËØ¥‰∏∫‰∫ÜÁºñËØëÈÄöËøáËÄå‰ªòÂá∫ÁöÑÂä™ÂäõÔºåÂçïÂçïÊòØ Arc Âíå Mutex Â∏¶Êù•ÁöÑÈ¢ùÂ§ñÂºÄÈîÄÔºå‰πüÊòØÊó†Ê≥ïÊé•ÂèóÁöÑ„ÄÇÂΩìÂàõÂª∫Â§ßÂûãÁ®ãÂ∫èÊó∂ÔºåÁÆÄÁõ¥Êó†Ê≥ïÊÉ≥Ë±°„ÄÇ </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">get_foos</span></span>(client: Client) -&gt; <span class="keyword">impl</span> Future&lt;Output = <span class="built_in">Vec</span>&lt;Response&gt;&gt;&#123;</span><br><span class="line">    <span class="keyword">let</span> client: Arc&lt;Mutex&lt;Client&gt;&gt; = Arc::new(Mutex::new(Client));</span><br><span class="line">    <span class="keyword">let</span> client2 = client.clone();</span><br><span class="line"></span><br><span class="line">    client.lock().unwrap().get_index(<span class="string">&quot;/foos&quot;</span>).and_then(<span class="keyword">move</span> |index|&#123;</span><br><span class="line">        client2.lock().unwrap().get_responses(&amp;index).collect()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Âõ†Ê≠§ÔºåRust Âõ¢ÈòüËøõË°åËÆæËÆ°‰∫Ü‰∏ÄÂ•óÂü∫‰∫é Future ÁöÑ APIÔºåÊèêÂá∫‰∫Ü async/await ËøôÁªÑÂÖ≥ÈîÆÂ≠óÔºåÂ∞ÜÂºÇÊ≠•‰ª£Á†ÅËΩ¨Êç¢ÊàêÂêåÊ≠•Ê®°ÂûãÔºåËøô‰∏ç‰ªÖÂõûÈÅø‰∫Ü‰∏äÈù¢ÁöÑÊâÄÊúâÊùÉÈóÆÈ¢òÔºåËøòÊõ¥Âä†Á¨¶Âêà‰∫∫‰ΩìÂ∑•Á®ãÂ≠¶„ÄÇ </p>
<p>ËøôÁßçÂÜôÊ≥ïÈùûÂ∏∏Êé•Ëøë <code>blocking io</code>ÔºåÁ®ãÂ∫èÂëòËÉΩËΩªÊòìÁúãÂá∫ÊâßË°åÁöÑÈÄªËæëÔºåÂç¥ËÉΩÂ§ü‰ª•ÂºÇÊ≠•ÁöÑÊñπÂºèËøêË°åÔºåËøô‰∏ªË¶ÅÂΩíÂäü‰∫é Rust ÁºñËØëÂô®ÂØπ‰∫é async ‰ª£Á†ÅÂùóÁöÑÈ´òÁ∫ßÊäΩË±°Ôºåasync block ‰ºöË¢´ÁøªËØëÊàê‰∏Ä‰∏™<strong>Áä∂ÊÄÅÊú∫ GenFuture</strong>ÔºàÂåøÂêçÁªìÊûÑ‰ΩìÔºâÔºåÂπ∂‰∏îÂÖ∂‰∏≠‰ªª‰ΩïË∑®Ë∂ä await ‰ª£Á†ÅÂùóÁöÑÂºïÁî®ÔºåÈÉΩ‰ºöÂ∞ÜË¢´ÂºïÁî®ÁöÑÂèòÈáèÂíåÂºïÁî®‰øùÂ≠òÂà∞ÂΩìÂâç‰∏∫ async ‰ª£Á†ÅÂùóÁîüÊàêÁöÑÁä∂ÊÄÅÊú∫‰∏≠ÔºåÊØè‰∏Ä‰∏™ await ÁÇπÈÉΩÊòØÁä∂ÊÄÅÁöÑËΩ¨ÂèòÊó∂Êú∫„ÄÇ  </p>
<p>ËøôÊ†∑ÁöÑËÆæËÆ°ÊòØÂçÅÂàÜ‰ºòÈõÖÁöÑÔºå‰πüÈùûÂ∏∏ÊúâÊïàÔºå‰ΩÜÊòØÂç¥Â∏¶Êù•‰∫Ü‰∏Ä‰∏™ÈóÆÈ¢òÔºö<strong>Ëá™ÂºïÁî®</strong> „ÄÇÊù•Áúã‰∏ãÈù¢Ëøô‰∏™‰æãÂ≠êÔºö  </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">get_foos</span></span>(client: Client) -&gt; <span class="built_in">Vec</span>&lt;Response&gt;&#123;</span><br><span class="line">    <span class="keyword">let</span> index = client.get_index(<span class="string">&quot;/foos&quot;</span>).<span class="keyword">await</span>; <span class="comment">// State &#123; Client, &amp;mut Client&#125;</span></span><br><span class="line">    client.get_responses(&amp;index).collect().<span class="keyword">await</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>‰∏äÈù¢ÁöÑ‰ª£Á†Å‰∏≠Ôºå<code>let index = client.get_index(&quot;/foos&quot;).await;</code> Â≠òÂú®‰∏Ä‰∏™Ë∑®Ë∂ä await ÂÖ≥ÈîÆÂ≠óÁöÑÂØπ‰∫é client ÁöÑÂºïÁî®ÔºåÂõ†Ê≠§ÔºåÂøÖÈ°ªË¶ÅÂ∞Ü client Âíå &amp;mut client ÈÉΩ‰øùÂ≠òÂú®Áä∂ÊÄÅÊú∫‰∏≠„ÄÇÔºàËøôÈáå‰∏çÂéªËÄÉËôëÊâãÂä®ÊûÑÈÄ†ÁöÑÈóÆÈ¢òÔºåÈúÄË¶Å unsafe ‰ª£Á†ÅÊìç‰ΩúË£∏ÊåáÈíàÊâçÂèØ‰ª•ÔºåÁºñËØëÂô®ÂÆûÁé∞Ëµ∑Êù•‰ºöËΩªÊùæÂæàÂ§öÔºâ</p>
<p>Â¶ÇÊûúÊåâÁÖßÊúÄÂéüÂßãÁöÑ Future Êé•Âè£( <code>fn poll(&amp;mut self, ctx: &amp;mut Context&lt;&#39;_&gt;)</code>)ÔºåÊàë‰ª¨ÂæàËΩªÊòìÂ∞±ËÉΩÂú®ÂÆâÂÖ®‰ª£Á†Å‰∏≠ËÆ© Rust Á®ãÂ∫èÂ¥©Ê∫ÉÔºö</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">bar</span></span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> future = get_foos(...);</span><br><span class="line">    future.poll(...);</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> future2 = get_foos(...); <span class="comment">// ‰∏∫‰∫ÜÈò≤Ê≠¢ let mut future2 = future Âè™ÊòØ‰∏Ä‰∏™Âà´ÂêçÔºåÂº∫Âà∂ÂàùÂßãÂåñ future2Ôºå‰ªéËÄå‰∏ãÈù¢ÁöÑ future2 = future Êàê‰∏∫‰∏Ä‰∏™ memcpy Êìç‰Ωú</span></span><br><span class="line">    future2 = future;       <span class="comment">// Ëá™ÂºïÁî®ÁªìÊûÑÂ∑≤ÁªèÂ§±ÊïàÔºåÂõ†‰∏∫ future Âíå future2 ÈÉΩÊòØÊ†à‰∏äÁöÑÁªìÊûÑ</span></span><br><span class="line">    future2.poll(...); <span class="comment">// Ê≠§Êó∂ÂÆåÂÖ®Êó†Ê≥ïÊéßÂà∂ poll ‰∏≠ÊòØÂê¶‰ºö‰ΩøÁî®ËØ•Â§±ÊïàÁöÑËá™ÂºïÁî® Ôºå</span></span><br><span class="line">                       <span class="comment">// ‰∫ßÁîü‰∫Ü undefined behavior</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>‰∏äÈù¢‰ª£Á†ÅÂ≠òÂú®ÁöÑÈóÆÈ¢òÊòØÔºöÂΩì poll ‰∏Ä‰∏™ Future ‰πãÂêéÔºåÊàë‰ª¨ÁßªÂä®‰∫ÜÂÆÉÂéüÊú¨ÁöÑ‰ΩçÁΩÆÔºåÂØºËá¥ Future ‰∏≠ÁöÑ<strong>Ëá™ÂºïÁî®ÁªìÊûÑÂ§±Êïà</strong>„ÄÇ </p>
<p>Ëøô‰ºº‰πéÊúâ‰∏ÄÁÇπËé´ÂêçÂÖ∂Â¶ôÔºåÊ∑±Á©∂‰∏Ä‰∏ãÊ†πÊ∫êÔºå‰Ω†‰ºöÂèëÁé∞ÔºåËøôÂíåÂ†Ü„ÄÅÊ†àÁöÑÁâπÊÄßÊúâÂÖ≥„ÄÇ </p>
<p>Âú®Ê†à‰∏äÂàÜÈÖçÁöÑÂèòÈáèÔºåÂ¶ÇÊûúÁßªÂä®‰∫ÜÊâÄÊúâÊùÉÔºåÂÖ∂Â§ßÊ¶ÇÁéáÔºàÂ¶ÇÊûú‰∏çÊòØÈÄöËøáÂà´ÂêçÂ§çÁî®ËøôÂùóÂÜÖÂ≠òÁöÑËØùÔºâ‰πü‰ºöÈáçÊñ∞ÂàÜÈÖç‰∏ÄÂùóÂÜÖÂ≠òÔºåÂπ∂‰∏îÂéüÂÖàÁöÑÂÜÖÂ≠ò‰ºöÂ§±Êïà„ÄÇÂèÇÁÖß‰∏ãÂõæÔºåÂú® <code>state2 = state1;</code> ‰πãÂêéÔºå‰ºöÂ∞Ü state1 ‰∏≠ÁöÑÂÜÖÂÆπÂÆåÂÆåÊï¥Êï¥Êã∑Ë¥ùÂà∞ state2 ‰∏≠Ôºå‰ΩÜÊòØ State ‰∏≠ÁöÑ <code>&amp;mut client</code>ÔºåËøòÊåáÂêë state1 ÈÇ£ÂùóÂ∑≤ÁªèÂ§±ÊïàÁöÑÂÜÖÂ≠òÔºåËøôÊâç‰∫ßÁîüÁöÑ UB Ë°å‰∏∫</p>
<div align=center>
<img height=70% width=70% src="/images/pin1.png" / loading="lazy">
<br/>
<br/>
</div>
Ëß£ÂÜ≥ÁöÑÂäûÊ≥ïÂæàÁÆÄÂçïÔºöÂ†ÜÂÜÖÂ≠òÂàÜÈÖçÔºÅ 

<p>Â¶ÇÊûúÊàë‰ª¨Âú®Ê†à‰∏äÂè™‰øùÁïô‰∏Ä‰∏™ÊåáÈíàÔºåÊåáÂêëÂ†Ü‰∏äÂàÜÈÖçÁöÑ StateÔºåÈÇ£‰πàÔºåÂΩìÊâÄÊúâÊùÉÂèëÁîüËΩ¨ÁßªÁöÑÊó∂ÂÄôÔºå‰ªÖ‰ªÖÊòØ‰πãÂâçËøô‰∏™ÊåáÈíàÂ§±Êïà‰∫ÜÔºåÂ†Ü‰∏äÁöÑ<strong>ÂÄºÂºïÁî®ÁªìÊûÑ</strong>Âπ∂Ê≤°ÊúâÁßªÂä®Ôºå‰πüÊ≤°ÊúâË¢´ÈáäÊîæÔºå‰ªçÁÑ∂ÊòØÊúâÊïàÁöÑ„ÄÇ</p>
<div align=center>
<img height=70% width=70% src="/images/pin2.png" / loading="lazy">
<br/>
<br/>
</div>

<p>ËøôÁßçÊ®°ÂºèÔºåÂ∞±Â•ΩÂÉèÂ∞Ü State Èíâ(Pin)Âú®‰∫ÜÂ†ÜÁ©∫Èó¥‰∏≠ÔºåÊó†ËÆ∫Ê†à‰∏äÁöÑÊåáÈíàÊÄé‰πàÁßªÂä®ÔºåÂ†Ü‰∏äÁöÑÂÜÖÂ≠òÈÉΩ‰∏ç‰ºöÂèóÂà∞ÂçäÁÇπÂΩ±Âìç„ÄÇ</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> state3 = state2;</span><br><span class="line"><span class="keyword">let</span> state4 = state3; <span class="comment">// totally fine</span></span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="‰∫å-Future-ÊîπËøõÔºåPin-ÂºïÂÖ•"><a href="#‰∫å-Future-ÊîπËøõÔºåPin-ÂºïÂÖ•" class="headerlink" title="‰∫å. Future ÊîπËøõÔºåPin ÂºïÂÖ•"></a>‰∫å. Future ÊîπËøõÔºåPin ÂºïÂÖ•</h2><p>withoutboats ‰Ωú‰∏∫ Rust ÂºÇÊ≠•Êú∫Âà∂ÁöÑ‰∏ªË¶ÅËÆæËÆ°ËÄÖÔºåÈíàÂØπÂéüÂßãÁöÑ Future trait ÊèêÂá∫‰∫ÜÂá†‰∏™ÊñπÊ°àÔºö</p>
<h3 id="1-unsafe-Ê†áËÆ∞"><a href="#1-unsafe-Ê†áËÆ∞" class="headerlink" title="1. unsafe Ê†áËÆ∞"></a>1. unsafe Ê†áËÆ∞</h3><p>Ëøô‰∏™ÊñπÊ°àËß£ÂÜ≥ÁöÑÊÄùË∑ØÊòØÔºö‰∏∫‰∫Ü‰ΩøÁî® FutureÔºå‰Ω†ÂøÖÈ°ªË¶ÅÁ°Æ‰øù SAFETYÔºöËØ• Future ‰∏ÄÊó¶Ë¢´ poll ‰πãÂêéÔºåÁõ¥Âà∞ÂÖ∂Ë¢´ Drop ÈÉΩ‰∏ç‰ºöË¢´ÁßªÂä®„ÄÇ<br>ÂØπ‰∫éÂàÜÈÖçÂú®Â†Ü‰∏äÁöÑ future Â§©ÁîüÂ∞±Êª°Ë∂≥Ëøô‰∏ÄÁÇπË¶ÅÊ±ÇÔºåÊâÄ‰ª•Ëøô‰∏ªË¶ÅÊòØÈíàÂØπÂú®Ê†à‰∏äÁöÑÂÜÖÂ≠òËÄåË®ÄÁöÑÁ∫¶Êùü„ÄÇ </p>
<p>ËôΩÁÑ∂ËøôÁ°ÆÂÆûÂèØ‰ª•Ëß£ÂÜ≥Áé∞Èò∂ÊÆµ Future ÁßªÂä®ÂØºËá¥ÁöÑÈóÆÈ¢òÔºå‰ΩÜËøô‰ºöÂ∏¶Êù•‰∏Ä‰∏™‰∏çÂæó‰∏çËÄÉËôëÁöÑÈóÆÈ¢òÔºöÊú¨Â∞±‰∏çÂèóÂ§ßÂÆ∂Ê¨¢ËøéÁöÑ unsafe ÂèØËÉΩ‰ºöÈÅçÂ∏É‰ª£Á†ÅÂ∫ìÔºÅËÄå‰∏îÁõ∏ÂΩì‰∫éÊääÈîÖÈÉΩÁî©Áªô‰∫ÜÁî®Êà∑ÔºåÂ§ßÂ§ßÂä†Èáç‰∫ÜÂºÄÂèë‰∫∫ÂëòÂøÉÊô∫Ë¥üÊãÖÔºåËØ•ÊñπÊ°à‰Ωú‰∏∫ÈíàÂØπ Future Êé•Âè£ÁöÑÁ¨¨‰∏ÄÊ¨°ÊîπËøõÔºå‰πüÂ∞±Âà∞Ê≠§‰∏∫Ê≠¢„ÄÇ</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">trait</span> <span class="title">Future</span></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Output</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsafe</span> <span class="function"><span class="keyword">fn</span> <span class="title">poll</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, ctx: &amp;<span class="keyword">mut</span> Context&lt;<span class="symbol">&#x27;_</span>&gt;) -&gt; Poll&lt;Self::Output&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-Pin-ÁöÑÂéüÂßãÁâàÊú¨"><a href="#2-Pin-ÁöÑÂéüÂßãÁâàÊú¨" class="headerlink" title="2. Pin ÁöÑÂéüÂßãÁâàÊú¨"></a>2. Pin ÁöÑÂéüÂßãÁâàÊú¨</h3><p>unsafe Future Trait ÁöÑÊñπÊ°àË¢´ pass ‰πãÂêéÔºåRust Âõ¢ÈòüÂºÄÂßãÂØªÊ±ÇÂà´ÁöÑËß£ÂÜ≥ÊñπÂºèÔºåÂπ∂ÊèêÂá∫‰∫Ü Pin ÁöÑÊ¶ÇÂøµ„ÄÇ </p>
<p>‰ΩÜ Pin ÊúÄ‰∏ÄÂºÄÂßãÂπ∂‰∏çÂÉèÁé∞Âú®ËøôÊ†∑ÁÆÄÊ¥ÅÔºåÂÖ∂‰πüÊòØÁªèÂéÜ‰∫ÜÂæàÂ§öËÆæËÆ°‰∏äÁöÑÊîπËøõ„ÄÇÊúÄ‰∏ÄÂºÄÂßãÁöÑËÆæËÆ°ÂÖ∂ÂÆûÈïø‰∏ãÈù¢ËøôÊ†∑Ôºö</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">PinMut</span></span>&lt;<span class="symbol">&#x27;a</span>, T&gt;(&amp;<span class="symbol">&#x27;a</span> <span class="keyword">mut</span> T);</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;<span class="symbol">&#x27;a</span>, T&gt; PinMut&lt;<span class="symbol">&#x27;a</span>, T&gt; &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">unsafe</span> <span class="function"><span class="keyword">fn</span> <span class="title">get_mut_unchecked</span></span>(<span class="keyword">self</span>) -&gt; &amp;<span class="symbol">&#x27;a</span> <span class="keyword">mut</span> T&#123;</span><br><span class="line">        <span class="keyword">self</span>.<span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">PinBox</span></span>&lt;T&gt;(<span class="built_in">Box</span>&lt;T&gt;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt; <span class="built_in">From</span>&lt;<span class="built_in">Box</span>&lt;T&gt;&gt; <span class="keyword">for</span> PinBox&lt;T&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">from</span></span>(b: <span class="built_in">Box</span>&lt;T&gt;) -&gt; PinBox&lt;T&gt; &#123;</span><br><span class="line">        PinBox(b)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt; PinBox&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">as_mut</span></span>&lt;<span class="symbol">&#x27;a</span>&gt;(&amp;<span class="symbol">&#x27;a</span> <span class="keyword">mut</span> <span class="keyword">self</span>) -&gt; &amp;<span class="symbol">&#x27;a</span> <span class="keyword">mut</span> T&#123;</span><br><span class="line">        PinMut(&amp;<span class="keyword">mut</span> *<span class="keyword">self</span>.<span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">trait</span> <span class="title">Future</span></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Output</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">poll</span></span>(<span class="keyword">self</span>: PinMut&lt;<span class="symbol">&#x27;_</span>, <span class="keyword">Self</span>&gt;, ctx: &amp;<span class="keyword">mut</span> Context&lt;<span class="symbol">&#x27;_</span>&gt;) -&gt; Poll&lt;Self::Output&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ËøôÈáåÂºïÂÖ•‰∫Ü <code>PinBox</code> Âíå <code>PinMut</code> ‰∏§‰∏™Ê¶ÇÂøµÔºåÈÉΩÊòØÂØπ‰∫éÊåáÈíàÁöÑÂ∞ÅË£ÖÔºåÊúÄÂ§ßÁöÑ‰∏çÂêåÊòØÔºåÂ¶ÇÊûúÊÉ≥Ë¶ÅÈÄöËøá <code>PinMut</code> Ëé∑ÂèñÂà∞ËÉåÂêéÁöÑÊåáÈíàÔºåÂøÖÈ°ªË¶ÅÈÄöËøáÈùûÂÆâÂÖ®ÊñπÊ≥ïÂÆåÊàêÔºåËÄåÂØπ‰∫é <code>PinBox</code> ËÄåË®ÄÔºåÂàôÊòØÂèØ‰ª•Áõ¥Êé•Âú®ÂÆâÂÖ®‰ª£Á†Å‰∏≠Ëé∑Âèñ Box ËÉåÂêéÁöÑÂØπË±°ÊåáÈíà„ÄÇ  </p>
<p>ËøôÁßçÂ∞ÅË£ÖÔºåÂ∏¶Êù•‰∫Ü‰∏Ä‰∏™ÂæàÂ§ßÁöÑÂ•ΩÂ§ÑÔºöÂ¶ÇÊûúÊÉ≥Ë¶ÅÈÄöËøá PinMut Ëé∑ÂèñËÉåÂêéÁöÑÂºïÁî®ÔºåÂè™ËÉΩÈÄöËøá get_mut_unchecked ËøôÁßç unsafe ÁöÑÊñπÂºèÔºåÈÇ£‰πàÔºåÂΩìÊàë‰ª¨Â∞Ü Future ÁöÑ self Á±ªÂûãÈôêÂÆö‰∏∫ <code>PinMut&lt;&#39;_, Self&gt;</code> ÁöÑÊó∂ÂÄôÔºåÂ∞±‰ºöÂèëÁé∞ÔºåÂπ∂‰∏çÊòØÈÇ£‰πàËΩªÊòìÂ∞±ËÉΩËé∑ÂèñÂà∞ <code>&amp;mut self</code> ÁöÑÂì¶ÔºåÂøÖÈ°ªË¶ÅÁ°Æ‰øùËøô‰∏™Êìç‰ΩúÁöÑ <strong>SAFETY</strong>Ôºå‰πüÂ∞±‰∏çÂèØËÉΩÂú®ÂÆâÂÖ®‰ª£Á†Å‰∏≠ÔºåÁõ¥Êé•Ëé∑ÂèñÂà∞ &amp;mut selfÔºåÁªßËÄåÂØºËá¥ future ‰∏≠ÂÜÖÂÆπË¢´ËΩªÊòìÁßªÂä®„ÄÇÂπ∂‰∏îÔºåÂü∫‰∫éËøô‰∏§‰∏™ÊäΩË±°ÔºåÊ≠£Á°ÆÊÄßËØÅÊòéËµ∑Êù•ÊòØÊØîËæÉÂÆπÊòìÁöÑ„ÄÇ    </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = PinMut(&amp;<span class="keyword">mut</span> p);</span><br><span class="line"><span class="comment">// error to compile</span></span><br><span class="line">mem::swap(a.get_mut_unchecked(),&amp;<span class="keyword">mut</span> something_else);</span><br><span class="line"><span class="comment">// ok to compile, but usage of unsafe is wrong</span></span><br><span class="line">mem::swap(<span class="keyword">unsafe</span> &#123; a.get_mut_unchecked() &#125;,&amp;<span class="keyword">mut</span> something_else);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ËøôÊÆµËØù‰∏≠ËøòÂºïÂÖ•‰∫Ü‰∏ÄÁÇπÔºåÂ¶ÇÊûúËÉΩÂ§üÂú®ÂÆâÂÖ®‰ª£Á†Å‰∏≠ÔºåËé∑ÂèñÂà∞Ëá™ÂºïÁî®ÁªìÊûÑÁöÑÂèØÂèòÂºïÁî®Ôºå‰πü‰ºöÂØºËá¥ Rust ÁªôÊàë‰ª¨ÂÅöÂá∫ÁöÑÂÆâÂÖ®ËßÑËåÉËΩ∞ÁÑ∂ÂÄíÂ°å<br>ÁªìÂêà‰πãÂâçÁöÑÂ†Ü„ÄÅÊ†àÂàÜÈÖçÁöÑÁâπÁÇπÔºåÂÆûÈôÖ‰ΩøÁî®‰∏≠Ôºå‰ºöÂÖàÂ∞ÜÂÖ∂ÂàÜÈÖçÂú®Â†Ü‰∏äÔºå‰øùËØÅ‰∏ç‰ºöÂõ†‰∏∫ <code>let mut future2 = future1;</code> ËøôÁßçËØ≠‰πâÂ∞ÜÂÖ∂ÁßªÂä®ÔºåÂÖ∂Ê¨°ÔºåÂ∞±ÊòØÈÅµÂÆà PinMut ÁªôÊàë‰ª¨ÁöÑÁ∫¶ÊùüÔºå‰øùËØÅ‰∏ç‰ºöËé∑ÂèñÂà∞ÂèØÂèòÂºïÁî®ËÄåÁßªÂä®„ÄÇ </p>
<p>Áõ∏ÊØîÂ¶ÇÁ¨¨‰∏Ä‰∏™ unsafe ÊèêÊ°àÔºåÊàë‰ª¨ËôΩÁÑ∂ÂÖç‰∏ç‰∫ÜÂíå unsafe Êâì‰∫§ÈÅìÔºå‰ΩÜÊòØÂ∑≤ÁªèÂèØ‰ª•ÂæóÂà∞‰∏Ä‰∏™ÈùûÂ∏∏Âπ≤ÂáÄÁöÑ Future Êé•Âè£ÔºåË∞ÉÁî® poll ‰πü‰∏çÈúÄË¶ÅÂÜçÁî® unsafe Êù•ÊñπÂºèËØØÁî®‰∫ÜÔºåÁõ∏ÂΩì‰∫éÊòØÂ∞Ü unsafe ÈÄªËæëËΩ¨ÁßªÂà∞‰∫ÜÂÜÖÂ±ÇÂÆûÁé∞‰∏≠„ÄÇ</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">spawn</span></span>&lt;F: Future&gt;(f: F)&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> fut = PinBox::from(<span class="built_in">Box</span>::new(f));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// safe the fut to somewhere</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// handin to the executor</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// construct PinMut, then poll</span></span><br><span class="line">    fut.as_mut().poll(...);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>‰ΩÜÂç≥‰ΩøÊòØÂÜÖÂ±ÇÁöÑ unsafe ÈÄªËæëÔºå‰πü‰ºöÁªôÂºÄÂèë‰∫∫ÂëòÂ∏¶Êù•ÂæàÂ§ßÁöÑÂøÉÊô∫Ë¥üÊãÖÔºÅ </p>
<p>Âú®‰∏äÈù¢ÁöÑÁ∫¶Êùü‰∏ãÔºåÊàë‰ª¨Â¶ÇÊûúÊÉ≥Ë¶ÅÂú® poll ÊñπÊ≥ï‰∏≠Êõ¥Êñ∞ self ÁöÑÁä∂ÊÄÅÔºåÊàñËÄÖË∞ÉÁî® self Êüê‰∏Ä‰∫õ field ÁöÑÊñπÊ≥ïÔºåÈÉΩË¶ÅÈ¶ñÂÖàÈÄöËøáÈùûÂÆâÂÖ®‰ª£Á†ÅÔºåËé∑Âèñ &amp;mut SelfÔºåÁõ∏ÂΩì‰∫éÂ£∞ÊòéÔºöÊàëÈÅµÂÆà unsafe Ëµã‰∫àÊàëÁöÑ‰∏ÄÂàáÊùÉÂäõÔºåÊàë‰øùËØÅ‰∏ç‰ºöÁßªÂä® self„ÄÇ</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AsyncIoHandle</span></span>&#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">poll_read</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>,buf: &amp;<span class="keyword">mut</span> [<span class="built_in">u8</span>]) -&gt;Poll&lt;<span class="built_in">usize</span>&gt;&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">IoFuture</span></span> &#123;</span><br><span class="line">    buf: <span class="built_in">Vec</span>&lt;<span class="built_in">u8</span>&gt;,</span><br><span class="line">    file: AsyncFileHandle</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Future <span class="keyword">for</span> IoFuture &#123;</span><br><span class="line">    tyep Output = <span class="built_in">usize</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">poll</span></span>(<span class="keyword">self</span>: PinMut&lt;<span class="symbol">&#x27;_</span>, <span class="keyword">Self</span>&gt;, x: &amp;<span class="keyword">mut</span> Context&lt;<span class="symbol">&#x27;_</span>&gt;) -&gt; Poll&lt;Self::Output&gt;&#123;</span><br><span class="line">        <span class="comment">// wont&#x27;t compile </span></span><br><span class="line">        <span class="comment">// self.file.poll_read(&amp;mut self.buf[..]) </span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">unsafe</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> this: &amp;<span class="keyword">mut</span> <span class="keyword">Self</span> = <span class="keyword">self</span>.get_mut_unchecked();</span><br><span class="line">            this.file.poll(&amp;<span class="keyword">mut</span> this.buf[..]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ËøôÁßçÊÅº‰∫∫ÁöÑÈóÆÈ¢òÂØπ‰∫é <strong>Leaf Future</strong> Â∞§‰∏∫‰∏•Èáç„ÄÇÊâÄË∞ìÁöÑ <strong>Leaf Future</strong>ÔºåÂÖ∂ÂÆûÊòØÈù¢ÂêëÂ∫ïÂ±Ç Io(reactor)„ÄÅÈúÄË¶ÅÊâãÂä®ÂÆûÁé∞ÁöÑ FutureÔºå<strong>Non-Leaf Future</strong> Â∞±ÊòØÈÄöËøá async await Ëá™Âä®ÁîüÊàêÁöÑ FutureÔºåÂåÖÂê´‰∫Ü‰∏ãÈù¢ÁöÑÊâÄÊúâÁªìÁÇπÔºånon-leaf or leaf„ÄÇÊõ¥‰ª§‰∫∫Êó†Â•àÁöÑ‰∏ÄÁÇπÊòØÔºåÂØπ‰∫é 99% ÊâãÂä®ÂÆûÁé∞ÁöÑ <code>Leaf Future</code>ÔºåÂπ∂Ê≤°Êúâ <code>self referential</code> ÁöÑÈóÆÈ¢òÔºå‰ªçÈúÄË¶Å‰ΩøÁî® unsafe„ÄÇ  async/await ‰∏≠ÁöÑ <code>self referential</code> ÁÆóÊòØËß£ÂÜ≥Ôºå‰ΩÜÂèàÂèëÂäõËøáÁåõÔºå‰∏ÄÊ£íÂ≠êÊâìÊ≠ª‰∫ÜÊõ¥Â§öÁöÑ <strong>good future</strong>„ÄÇ</p>
<p>ÊÄªÁªì‰∏ÄÁÇπÔºö<strong>ÁõÆÂâç‰∏∫Ê≠¢ÔºåÈÄöËøá PinMut Âíå PinBox ÁöÑÊäΩË±°ÔºåÂ∑≤ÁªèËß£ÂÜ≥‰∫Ü executor ‰∏≠ÁöÑÈóÆÈ¢ò(ÊØîÂ¶ÇÈúÄË¶Å‰ΩøÁî® unsafe)ÔºåÊèê‰æõ‰∫ÜÊòìÁî®ÁöÑ Future::poll Êé•Âè£Ôºå‰ΩÜÊòØÂØπ‰∫é reactor ‰ªçÊó†Â§™Â•ΩÁöÑÂäûÊ≥ï„ÄÇPinMut Âíå PinBox ÁöÑÊ≠£Á°ÆÊÄßÊòØÊØãÂ∫∏ÁΩÆÁñëÁöÑ</strong>  </p>
<h3 id="3-Unpin-ÁöÑÂºïÂÖ•"><a href="#3-Unpin-ÁöÑÂºïÂÖ•" class="headerlink" title="3. Unpin ÁöÑÂºïÂÖ•"></a>3. Unpin ÁöÑÂºïÂÖ•</h3><p>‰∏∫‰∫ÜËß£ÂÜ≥‰∏äÈù¢ÁöÑÈóÆÈ¢òÔºåwithoutboats ÂºïÂÖ•‰∫Ü Unpin ÁöÑÊ¶ÇÂøµ„ÄÇ  </p>
<p>Unpin ÊòØ‰∏Ä‰∏™ auto traitÔºåRust ÈªòËÆ§‰∏∫ÊâÄÊúâÁªìÊûÑÈÉΩÊ∑ªÂä†‰∫ÜËøô‰∏™Ê†áËÆ∞ TraitÔºàÂÉè Send Âíå SyncÔºâÔºå‰ΩÜÊòØÔºåÂ¶ÇÊûú‰∏Ä‰∏™ÁªìÊûÑÂåÖÂê´‰∫Ü !Unpin ÁöÑÂ≠óÊÆµÔºåÈÇ£‰πàÂÖ∂Ëá™Ë∫´‰πüÊòØ !UnpinÔºà !Unpin Â±ûÊÄß‰ºö‰º†Êí≠ÔºâÔºåÂá†‰πéÂîØ‰∏ÄÁöÑ !Unpin ÁªìÊûÑÂ∞±ÊòØÁºñËØëÂô®‰∏∫ async ‰ª£Á†ÅÂùóÁîüÊàêÁöÑ GenFuture„ÄÇÂÖ∂‰ΩôÊâÄÊúâÁöÑÂü∫Á°ÄÁªìÊûÑÔºåÂåÖÊã¨ i32, usize ÈÉΩÊòØ Unpin ÁöÑÁªìÊûÑÔºåÊØîËæÉÁâπÊÆäÁöÑÊòØÂØπ‰∫éÂ§çÊùÇÁöÑËá™ÂºïÁî®ÁªìÊûÑÁöÑÊåáÈíà„ÄÇ  </p>
<p>ÂØπ‰∫éÂÜÖÈÉ®ÂåÖÂê´‰∫Ü Unpin ÁªìÊûÑÁöÑ PinMutÔºåÂè™ÈúÄË¶Å‰∏∫ÂÖ∂ÂÆûÁé∞ DerefMut ÊñπÊ≥ïÔºåÂ∞±ÂèØ‰ª•Áõ¥Êé•Ëé∑ÂèñÂà∞ &amp;mut TÔºåPinMut&lt;‚Äôa,T&gt; Âíå &amp;mut TÔºå‰πüÂ∞±‰∏çÈúÄË¶ÅÁÉ¶‰∫∫ÁöÑ unsafe ‰∫Ü! ‰πåÊãâÔºÅ   </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> auto <span class="class"><span class="keyword">trait</span> <span class="title">Unpin</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;<span class="symbol">&#x27;a</span>, T: Unpin + ?<span class="built_in">Sized</span>&gt; DerefMut <span class="keyword">for</span> PinMut&lt;<span class="symbol">&#x27;a</span>,T&gt;&#123;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Target</span></span> = T;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">deref_mut</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">Self</span>) -&gt; &amp;<span class="keyword">mut</span> Self::Target&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>ÊúÄÁªàÊñπÊ°à Pin</li>
</ol>
<p>ÊúÄÁªàÂºïÂÖ•Ê†áÂáÜÂ∫ìÁöÑÊñπÊ°àÂπ∂‰∏çÊòØ‰∏äÈù¢ÁöÑ PinMut + PinBoxÔºåËÄåÊòØÊõ¥Âä†ÁÆÄÊ¥ÅÁöÑ‰∏Ä‰∏™Áªü‰∏ÄÊé•Âè£Ôºö <strong>Pin</strong>  </p>
<p>Pin ‰πüÊòØ‰∏Ä‰∏™Êô∫ËÉΩÊåáÈíàÔºåÂÜÖÂ±ÇÂåÖË£Ö‰∫Ü‰∏Ä‰∏™ÊåáÈíàÔºåÈíàÂØπÂÜÖÈÉ®‰∏çÂêåÁöÑÊåáÈíàÁ±ªÂûãÔºåÂÆûÁé∞‰∫Ü‰∏çÂêåÁöÑ trait„ÄÇ </p>
<p>Ê†áÂáÜÂ∫ì‰∏≠Êúâ‰∏ãÈù¢Âá†‰∏™ÂÖ≥ÈîÆÁöÑÂáΩÊï∞ÔºåÈÉΩÂØπÂÆÉ‰ª¨ÂÅö‰∫ÜÊ≥®Ëß£Ôºö  </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Pin</span></span>&lt;P&gt;&#123;</span><br><span class="line">    pointer: P</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Áõ¥Êé•ÈÄöËøáË£∏ÊåáÈíàÂàõÂª∫ Pin ÊòØ‰∏çÂÆâÂÖ®ÁöÑÔºå‰ΩøÁî®ËÄÖÂøÖÈ°ªË¶ÅÁ°Æ‰øùÔºåËøô‰∏™ÊåáÈíàÊòØÊúâÊïàÁöÑ!</span></span><br><span class="line"><span class="keyword">impl</span> Deref&lt;P: Deref&gt; Pin&lt;P&gt;&#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">unsafe</span> <span class="function"><span class="keyword">fn</span> <span class="title">new_unchecked</span></span>(pointer: P) -&gt; Pin&lt;P&gt; &#123;</span><br><span class="line">        Pin &#123; pointer &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ÂêåÁêÜÔºåÂ∞Ü Pin ËΩ¨Êç¢ÊàêÂÜÖÈÉ®ÁöÑË£∏ÊåáÈíàÔºå‰πüÊòØ‰∏çÂÆâÂÖ®ÁöÑ!</span></span><br><span class="line"><span class="keyword">impl</span>&lt;<span class="symbol">&#x27;a</span>, P&gt; Pin&lt;<span class="symbol">&#x27;a</span> <span class="keyword">mut</span> P&gt;&#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">unsafe</span> <span class="function"><span class="keyword">fn</span> <span class="title">get_unchecked_mut</span></span>(<span class="keyword">self</span>) -&gt; <span class="symbol">&#x27;a</span> <span class="keyword">mut</span> P &#123;</span><br><span class="line">        <span class="keyword">self</span>.pointer</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Target::Unpin ÁöÑÊåáÈíà PÔºåÂèØ‰ª•ÂÆâÂÖ®Ëé∑Âèñ &amp;mut P::Target</span></span><br><span class="line"><span class="keyword">impl</span>&lt;P: DerefMut&lt;Target: Unpin&gt;&gt; <span class="keyword">for</span> Pin&lt;P&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">deref_mut</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) -&gt; &amp;<span class="keyword">mut</span> P::Target &#123;</span><br><span class="line">        Pin::get_mut(Pin::as_mut(<span class="keyword">self</span>))</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Â¶ÇÊûúË¶Å‰ªé Pin&lt;P&gt; ÂàõÂª∫Âá∫ Pin&lt;&amp;&#x27;a mut P::Target&gt;ÔºåËøòÊòØÂèØ‰ª•ÂäûÂà∞ÁöÑ</span></span><br><span class="line"><span class="comment">// Âõ†‰∏∫ Pin ÂßãÁªàÊúâËøô‰∏™ÊåáÈíàÁöÑÊâÄÊúâÊùÉÔºåÊâÄ‰ª•‰∏çÈúÄË¶ÅÊãÖÂøÉ‰ºöÂá∫Áé∞ UB Ë°å‰∏∫</span></span><br><span class="line"><span class="keyword">impl</span>&lt;P: DereMut&gt; Pin&lt;P&gt; &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">as_mut</span></span>&lt;<span class="symbol">&#x27;a</span>&gt;(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) -&gt; Pin&lt;&amp;<span class="symbol">&#x27;a</span> <span class="keyword">mut</span> P::Target&gt; &#123;</span><br><span class="line">        <span class="keyword">unsafe</span> &#123; Pin::new_unchecked(&amp;<span class="keyword">mut</span> *<span class="keyword">self</span>.pointer) &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// ‰ªé Box ÂàõÂª∫ Pin Êú¨Ë∫´Â∞±ÊòØÂÆâÂÖ®ÁöÑÔºåÂõ†‰∏∫ Box ÂÆûÁé∞‰∫Ü Unpin</span></span><br><span class="line"><span class="keyword">impl</span>&lt;P&gt; <span class="built_in">From</span>&lt;<span class="built_in">Box</span>&lt;P&gt;&gt; <span class="keyword">for</span> Pin&lt;<span class="built_in">Box</span>&lt;P&gt;&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">from</span></span>(b: <span class="built_in">Box</span>&lt;P&gt;) -&gt; Pin&lt;<span class="built_in">Box</span>&lt;P&gt;&gt;&#123;</span><br><span class="line">         <span class="keyword">unsafe</span> &#123; Pin::new_unchecked(b) &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ËøôÊÆµ‰ª£Á†ÅÂèØËÉΩÊúâ‰∏ÄÁÇπÁªïÔºå‰ΩÜÊòØÊ†∏ÂøÉÂÖ≥Ê≥®ÁÇπÂ∞±‰∏§‰∏™</p>
<ol>
<li>ÂØπ‰∫éÂÆûÁé∞‰∫Ü Deref Á±ªÂûãÁöÑ PÔºåÊòØÂê¶ÂèØ‰ª•ÂÆâÂÖ®Âú∞Ëé∑ÂèñÂà∞ÂÜÖÂ±ÇÁöÑËøô‰∏™ pointer</li>
<li>ÂØπ‰∫éÂÆûÁé∞‰∫Ü Deref Á±ªÂûãÁöÑ PÔºåÊòØÂê¶ÂèØ‰ª•ÂÆâÂÖ®Âú∞Ëé∑ÂèñÂÜÖÂ±Ç pointer ÊåáÈíàÊåáÂêëÁöÑÂØπË±°</li>
</ol>
<p>ÂßãÁªàË¶ÅÁâ¢ËÆ∞ Pin ÁöÑ‰ΩøÂëΩÔºöÈúÄË¶ÅÁ°Æ‰øù Rust ‰∏≠ async/await ‰ª£Á†Å‰∏≠ÁöÑËá™ÂºïÁî®ÁªìÊûÑÊúâÊïàÔºå‰∏çËÉΩÂú® safe code ‰∏≠ crash Rust ÁöÑÂº∫ÂÆâÂÖ®‰øùËØÅ„ÄÇ<strong>ËøôÊÆµ‰ª£Á†ÅÂÖ∂ÂÆûÊòØÊúâÈóÆÈ¢òÁöÑÔºåÂêéÈù¢‰ºöÊèêÂà∞</strong>„ÄÇ</p>
<p>ÁõÆÂâçÁöÑ Pin ÁöÑËÆæËÆ°ÔºåÊúÄÊ†∏ÂøÉÁöÑ API ÊòØ get_unchecked_mutÔºåËøôÈáåÁöÑ <strong>SAFETY</strong> ‰øùÈöúÊòØÔºöÂ¶ÇÊûú <code>&lt;P as DerefMut&gt;::Target </code> ÊòØ UnpinÔºåÈÇ£‰πàÊó†Ê≥ïÈÄöËøáÂÆâÂÖ®ÊâãÊÆµÂæóÂà∞ÂÖ∂ÂèØÂèòÂºïÁî®ÔºåÂê¶ÂàôÂ∞±ÂèØËÉΩÁßªÂä®ÂÖ∂ÂÜÖÂÆπÔºåÂØºËá¥Ëá™ÂºïÁî®Â§±ÊïàÔºà99%ÁöÑUnpinÈÉΩÂèëÁîüÂú®Ëá™ÂºïÁî®ÁªìÊûÑ‰∏äÔºâ</p>
<p>ÁªìÂêà‰∏äÈù¢ÁöÑ Unpin Ê¶ÇÂøµÔºåÊàë‰ª¨ÂèØ‰ª•ÈíàÂØπÂü∫Êú¨Á±ªÂûãÂíåËá™ÂºïÁî®ÁªìÊûÑÂàÜÂà´Êé¢ËÆ®‰∏Ä‰∏ãÂêàÁêÜÊÄß„ÄÇ</p>
<p>Âü∫Êú¨Á±ªÂûãÊòØ Unpin ÁöÑÔºåÂõ†Ê≠§ÂèØ‰ª•ÈÄöËøá <code>Pin::new</code> ÂàõÂª∫Ôºå‰πüÂèØ‰ª•ÈÄöËøá <code>b.get_mut()</code> Ëé∑ÂèñÂèØÂèòÂºïÁî®ÔºåË∑üÊôÆÈÄö‰ΩøÁî®ÊåáÈíàÊ≤°Êúâ‰ªª‰ΩïÂå∫Âà´</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> b = Pin::new(&amp;<span class="keyword">mut</span> a);</span><br><span class="line"><span class="keyword">let</span> c = b.get_mut();</span><br></pre></td></tr></table></figure>

<p>Êé•Êù•‰∏ãËÄÉËôë Pin Âú® async/await ËøôÁßçËá™ÂºïÁî®ÁªìÊûÑ‰∏äÁöÑËøêÁî®ÔºàÂâçÊèêÊòØÂ∑≤ÁªèÂàÜÈÖçÂú®Â†Ü‰∏ä‰∫ÜÔºâ„ÄÇ‰∏∫‰ªÄ‰πàÂØπ‰∫é‰∏Ä‰∏™ <code>Box&lt;impl Future&lt;...&gt;&gt;</code>ÔºåÊàë‰ª¨‰∏çÂ∫îËØ•ÂÆâÂÖ®ÁöÑËé∑Âèñ‰ª£Á†ÅÂùóÁöÑÂèØÂèòÂºïÁî®Ôºü</p>
<p>Êç¢Âè•ËØùËØ¥ÔºåÂ¶ÇÊûúÊàë‰ª¨ÂèØ‰ª•ÂÆâÂÖ®Âú∞Ëé∑ÂèñÔºåÂèØËÉΩ‰ºöÊÄéÊ†∑ËøùËÉå Rust ÁöÑÂÆâÂÖ®ÂáÜÂàôÔºü  </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="built_in">Box</span>::new(<span class="keyword">async</span> &#123;&#125;); <span class="comment">// a is pined on the heap, but &lt;A as DerefMut&gt;::Target is still Unpin</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut</span> b = <span class="keyword">unsafe</span> &#123; Pin::new_unchecked(a) &#125;;</span><br><span class="line"><span class="keyword">let</span> c = b.as_mut();</span><br><span class="line"><span class="comment">// let d = c.get_unchecked_mut();</span></span><br><span class="line"><span class="keyword">let</span> d = <span class="keyword">unsafe</span> &#123; c.get_unchecked_mut() &#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Â¶ÇÊûúÂèØ‰ª•ÂÆâÂÖ®Ëé∑ÂèñÂà∞ &amp;mut GenFutureÔºå‰∏ÄÊó¶Âú®‰∏§Ê¨° poll ‰πãÈó¥ÔºåË¢´‰∏çÁü•ÊÉÖÁöÑÁî®Êà∑ÈÄöËøá <code>mem::swap()</code> Á≠âÊâãÊÆµÂ∞ÜÂÖ∂ÁßªÂä®Âá∫ÂéªÔºåÂ∞±‰ºöÂØºËá¥Ëá™ÂºïÁî®ÁªìÊûÑÂ§±Êïà üí• „ÄÇÂõ†Ê≠§Ôºå<code>Pin::get_mut_unchecked()</code> ÈúÄË¶ÅÈÄöËøá unsafe Êù•ËÆ©Áî®Êà∑Ëá™Â∑±ÂÅöÂá∫‰øùËØÅ„ÄÇ</p>
<p>ÂâçÈù¢Êàë‰ª¨‰πüÊèêÂà∞ÔºåÂ¶ÇÊûúÊÉ≥Ë¶ÅÈÄöËøá <code>Pin::new()</code> ËøôÁßçÊñπÂºèÂÆâÂÖ®Âú∞ÊûÑÈÄ† PinÔºåÈúÄË¶Å‰øùÈöú <code>&lt;P as DerefMut&gt;::Target: Unpin</code>ÔºåÂØπ‰∫é Future Êù•ËØ¥Ôºå‰πüÂ∞±Âè™ËÉΩÁî® Box ÂåÖË£Ö‰∏§Â±ÇÔºåÁ¨¨‰∏ÄÊ¨°ÊòØÂØπÂÜÖÈÉ® Future ÁöÑ BoxÔºåÁ¨¨‰∫åÊ¨°ÊòØÂØπÊåáÂêë <code>async &#123;&#125;</code> ÁöÑÊåáÈíàÁöÑ BoxÔºåÁÑ∂ÂêéÊàë‰ª¨‰πüÂèØ‰ª•ÈÄöËøá <code>b.as_mut().get_mut()</code> ÁöÑÊñπÂºèÂÆâÂÖ®Âú∞Ëé∑ÂèñÂà∞ <code>&amp;mut Box&lt;...&gt;</code>ÔºåWOWÔºÅÊàë‰ª¨ÂèØ‰ª•ÁßªÂä®ÈáåÈù¢ÁöÑÁªìÊûÑ‰∫ÜËÄ∂ÔºÅÈÇ£‰πà Rust Â¥©‰∫ÜÂêóÔºüÂ∞±ËøôÔºü    </p>
<p>Á≠âÁ≠âÔºåÂà´È´òÂÖ¥Â§™Êó©ÔºåÊ≥®ÊÑèÂà∞ Future::poll ÁöÑÊñπÊ≥ïÁ≠æÂêçÔºåË¶ÅÊ±ÇË¢´ poll ÁöÑ future ÂøÖÈ°ªË¶ÅË¢´ Pin ‰øùÊä§Ëµ∑Êù•ÔºåÊàë‰ª¨ËøôÈáåÂÜçÊÄé‰πàÁßªÂä® Box ÈáåÈù¢ÁöÑ FutureÔºåÈÉΩ‰∏çÂèØËÉΩÂΩ±Âìç Future::poll„ÄÇ‰∏Ä‰∏™ Box ÂéãÊ†πÂ∞±Êó†Ê≥ïË¢´ poll</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="built_in">Box</span>::new(<span class="built_in">Box</span>::new(<span class="keyword">async</span> &#123;&#125;));</span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut</span> b = Pin::new(a);</span><br><span class="line"><span class="keyword">let</span> c = b.as_mut().get_mut();</span><br></pre></td></tr></table></figure>


<h2 id="‰∏â-Â∞èÁªì"><a href="#‰∏â-Â∞èÁªì" class="headerlink" title="‰∏â. Â∞èÁªì"></a>‰∏â. Â∞èÁªì</h2><p>‰ΩøÁî® Pin ‰∏ªË¶ÅÊòØ‰∏∫‰∫ÜÈÅøÂÖçËá™ÂºïÁî® Future ÁöÑÁßªÂä®ÈóÆÈ¢òÔºåÊ†∏ÂøÉ‰ºöÂÖ≥Ê≥®‰∏§ÁÇπÔºö</p>
<ol>
<li>ÊòØÂê¶ÂàÜÈÖçÂú®Â†Ü‰∏ä</li>
<li>Âú®ÁªôÂá∫‰∫Ü Pin&lt;&amp;mut Self&gt; ‰πãÂêéÔºåÊòØÂê¶ËÉΩÂÆâÂÖ®Âú∞Ëé∑ÂèñÂà∞ &amp;mut Self</li>
</ol>
<p>ÂâçËÄÖÈù¢Âêë executorÔºåÂêéËÄÖÈù¢Âêë reactor  </p>
<h2 id="3-1-Á¨¨‰∏Ä‰∏™ÈóÆÈ¢òÔºåHeap-or-Stack"><a href="#3-1-Á¨¨‰∏Ä‰∏™ÈóÆÈ¢òÔºåHeap-or-Stack" class="headerlink" title="3.1 Á¨¨‰∏Ä‰∏™ÈóÆÈ¢òÔºåHeap or Stack?"></a>3.1 Á¨¨‰∏Ä‰∏™ÈóÆÈ¢òÔºåHeap or Stack?</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. Pin to the heap </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Box::pin(future) : Pin&lt;Box&lt;T&gt;&gt;</span></span><br><span class="line"><span class="comment">// for example</span></span><br><span class="line"><span class="keyword">let</span> a: Pin&lt;<span class="built_in">Box</span>&lt;<span class="keyword">dyn</span> Future&gt;&gt; = <span class="built_in">Box</span>::pin(future);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. Pin to the stack</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> f: <span class="keyword">impl</span> Future = <span class="keyword">async</span> &#123;&#125;;</span><br><span class="line"><span class="comment">// pin-utils crate</span></span><br><span class="line">pin_utils:pin_mut!(f);</span><br><span class="line">f: Pin&lt;&amp;<span class="keyword">mut</span> <span class="keyword">impl</span> Future&lt;..&gt;&gt;;</span><br></pre></td></tr></table></figure>

<p>ÂØπ‰∫é‰∏Ä‰∏™ÂàÜÈÖçÂú®Â†Ü‰∏äÁöÑ Future Êù•ËØ¥ÔºåÂΩìÁÑ∂ÂèØ‰ª•ÈöèÊÑè‚ÄùÁßªÂä®‚ÄùÔºåËøôÈáåÁöÑÁßªÂä®ÊåáÁöÑÊòØÔºå<code>Pin&lt;Box&lt;dyn Future&gt;&gt;</code> Ëøô‰∏™ÁªìÊûÑÁöÑÊâÄÊúâÊùÉ‰∏çÁÆ°Â¶Ç‰ΩïËΩ¨ÁßªÔºåËØ• Future ÁöÑÂÜÖÂ≠ò‰∏ÄÁõ¥(Pin)Âú®Â†Ü‰∏äÔºåÁõ¥Âà∞ Box Ë¢´ Drop Êâç‰ºöË¢´ÈáäÊîæÔºåÊØîÂ¶Ç‰∏ãÈù¢ÁöÑ‰æãÂ≠ê‰∏≠Ôºåa È¶ñÂÖàË¢´ pollÔºå‰∏çÁÆ°‰πãÂêéÊâÄÊúâÊùÉÂ¶Ç‰ΩïËΩ¨ÁßªÔºåÊîπÂèòÁöÑ‰πüÂè™ÊòØÊ†à‰∏äÁöÑÊåáÈíà‰ΩçÁΩÆÔºåËØ• <code>Box&lt;dyn Future&gt;</code> ÁöÑÂÜÖÂÆπ‰ªçÁÑ∂Âú®Â†Ü‰∏äÔºåÂõ†ËÄåËá™ÂºïÁî®‰πüÊòØÊúâÊïàÁöÑ</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">bar</span></span>()&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="built_in">Box</span>::pin(aysnc&#123; bar().<span class="keyword">await</span>; <span class="number">1</span>&#125;);</span><br><span class="line">a.poll(...);</span><br><span class="line"><span class="keyword">let</span> b = a;</span><br><span class="line"><span class="keyword">let</span> c = b;</span><br><span class="line"><span class="comment">// ‰ªçÁÑ∂ÊòØÊúâÊïàÁöÑ</span></span><br><span class="line">c.poll(...);</span><br></pre></td></tr></table></figure>

<p>ÂØπ‰∫é‰∏Ä‰∏™ÂàÜÈÖçÂú®Ê†à‰∏äÁöÑ Future Êù•ËØ¥ÔºåÂ¶ÇÊûúÊàë‰ª¨ÊÉ≥Ë¶ÅÊâãÂä® Poll Ëøô‰∏™ FutureÔºå‰πüÈúÄË¶ÅÂ∞ÜÂÖ∂ Pin ‰ΩèÔºåÊâçËÉΩÊª°Ë∂≥ <code>poll(self: Pin&lt;&amp;mut Self&gt;, cx: &amp;mut Context&lt;&#39;_&gt;)</code> ÁöÑÊñπÊ≥ïÁ≠æÂêçÔºåÊúâ‰∏§ÁßçÊñπÂºèÂèØ‰ª•ÂÆûÁé∞Ôºö</p>
<ol>
<li>ÈÄöËøá unsafe ‰ª£Á†ÅÔºå<code>Pin::new_unchecked(&amp;mut a)</code></li>
<li>ÈÄöËøá pin-utils Ëøô‰∏™ crate Êèê‰æõÁöÑ pin_mut! ÂÆèÊù•Ëß£ÂÜ≥  </li>
</ol>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">bar</span></span>()&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. unsafe ÂÆûÁé∞ÔºåÈúÄË¶ÅÊâãÂä®‰øùËØÅ a ‰∏çË¢´ move</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut</span> a = bar();</span><br><span class="line"><span class="keyword">let</span> f = <span class="keyword">unsafe</span> &#123; Pin::new_unchecked(&amp;<span class="keyword">mut</span> a) &#125;;</span><br><span class="line">f.poll(...);</span><br><span class="line"><span class="keyword">let</span> c = a;</span><br><span class="line">f.poll(..); <span class="comment">// BOM!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. pin_mut ÂÆèÂÆûÁé∞ÔºåÊõ¥Âä† clever ÁöÑÊñπÂºèÔºåÂõûÈÅø‰∫Ü a Ë¢´ move ÁöÑÂèØËÉΩ</span></span><br><span class="line"><span class="keyword">let</span> a = bar(); <span class="comment">// a ÊòØÂàÜÈÖçÂú®Ê†à‰∏äÁöÑ</span></span><br><span class="line">pin_mut!(a);  <span class="comment">// a now is Pin&lt;&amp;mut impl Future&lt;Output=()&gt;&gt;</span></span><br><span class="line">a.poll(...)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ÊòæÁÑ∂ÔºåÂØπ‰∫éÊ†à‰∏äÁöÑ GenFuture Êù•ËØ¥Ôºå‰ªÖ‰ªÖÊòØ <code>let c = a</code> ËøôÁßçËΩ¨ÁßªÊâÄÊúâÊùÉÁöÑÊñπÂºèÔºå‰πü‰ºöËÆ© Pin&lt;&amp;mut ‚Ä¶&gt; Â§±ÊïàÔºåÊ†à‰∏äÁöÑ Future ‰∏ÄÊó¶Â∑≤Áªè pollÔºåÊ†πÊú¨Êó†Ê≥ïÂú®Á∫øÁ®ãÈó¥ËΩ¨ÁßªÔºåÊõ¥Âà´ÊèêË∞ÉÂ∫¶‰∫ÜÔºåÂè™ÊúâÂú®Ê≤°ÊúâÂ†ÜÂÜÖÂ≠òÂàÜÈÖçÁöÑÂµåÂÖ•ÂºèÁ≥ªÁªü‰∏≠ÔºåÊâç‰ºöÂÆûÁé∞ÁâπÊÆäÁöÑ runtimeÔºå‰øùËØÅ‰∏ÄÂÆöÂú®ÁâπÂÆöÁöÑ Stack ‰∏äÂéª poll Ëøô‰∏™Â∑≤Áªè Pin ‰ΩèÁöÑ Future„ÄÇÂõ†‰∏∫‰∏ÄÊó¶Á¶ªÂºÄ‰∫ÜËøô‰∏™ÊâßË°åÊ†àÔºåËøô‰∏™ Future ‰πüÂ∞±Â§±Êïà‰∫Ü„ÄÇËÄåÁ¨¨‰∫åÁßçÊñπÂºè‰∏≠ÁöÑ pin_mut!ÔºåÁî±‰∫é Rust Âç´ÁîüÂÆèÁöÑÁâπÊÄßÔºåÂ∞ÜÂèòÈáè a Ë¶ÜÁõñ‰∫ÜÔºåÂ∞±Êó†Ê≥ïÈÄöËøáÈô§ÈùûÂÆâÂÖ®‰ª£Á†Å‰πãÂ§ñÁöÑÊñπÂºèËé∑ÂèñÂà∞ <code>&amp;mut a</code>Ôºå‰ªéËÄå‰øùËØÅÂÆâÂÖ®ÊÄß„ÄÇ</p>
<p>ÂØπÊØî‰∫Ü <code>Box::pin Âíå pin_mut!</code>ÔºåÊàë‰ª¨ÂèØ‰ª•ÂæóÂá∫‰∏ãÈù¢ÁöÑÁªìËÆ∫Ôºö</p>
<ul>
<li>ÂΩìÈúÄË¶ÅËøîÂõû‰∏Ä‰∏™ BoxÔºåÊàñËÄÖË¶ÅÂ∞Ü‰∏Ä‰∏™ Future ‰øùÂ≠òÂú®ÁªìÊûÑ‰Ωì‰∏≠ÔºåÈúÄË¶ÅÁî® <code>Box::pin</code></li>
<li>ÂΩìÁõÆÁöÑÊòØÂú®Êüê‰∏™ÂáΩÊï∞‰∏≠‰ΩøÁî® FutureÔºåÊõ¥Â∫îËØ•Áî®‰∏ä pin_mut!ÔºåÂèØ‰ª•ËäÇÁúÅ heap allocation ÁöÑÂºÄÈîÄ</li>
</ul>
<p>ËøôÈáåÂøÖÈ°ªË¶ÅË°•ÂÖÖ‰∏Ä‰∏™Áü•ËØÜÁÇπÔºå‰πüÂ∞±ÊòØ Future ÁöÑ‰∏§ÁßçÊâßË°åÊñπÂºè:</p>
<ol>
<li>runtime::spawn(future)   ‚Äì È°∂Â±Ç Future</li>
<li>future.await                       ‚Äì ‰∫§Áªô parent Future ÊâßË°å</li>
</ol>
<p>Á¨¨‰∏ÄÁßçÊñπÂºè‰∏≠Ôºåruntime ‰ºöÈ¶ñÂÖàÂØπÈ°∂Â±ÇÁöÑ Future ÂÅö‰∏ÄÊ¨°Â†ÜÂàÜÈÖçÔºåÊàë‰ª¨Â∞±Âè´ÂÆÉ root FutureÔºåÊó†ËÆ∫ root Future ÊòØÂê¶ÊòØ Unpin ÁöÑÔºå<code>Box&lt;dyn Future&gt;</code> ‰∏ÄÂÆöÂÆûÁé∞‰∫Ü UnpinÔºåÂ∞±ÂèØ‰ª•‰∫§Áªô executor ÂÆâÂÖ®Âú∞ÊâßË°å poll ‰∫Ü</p>
<p>Á¨¨‰∫åÁßçÊñπÂºè‰∏≠ÔºåËØ• Future ‰ºöË¢´ parent Future(async) <strong>ÊÑüÁü•</strong>ÔºåÂú®Ë¢´ grand parent ÊÑüÁü•‚Ä¶ÔºåÂà∞ÊúÄÂêé‰πü‰∏ÄÂÆöÊòØÈÄöËøáruntime::spawn Êù•ÊâßË°åÁöÑ„ÄÇÂ¶ÇÊûúÂ∞ÜÂÖ∂ËßÜ‰∏∫‰∏ÄÈ¢ó Future Ê†ëÔºåÂÜÖÈÉ®ÊâÄÊúâÁöÑÂ≠êÂ≠ô Future ÈÉΩ‰ºöÂ§çÁî® root Future ÂàÜÈÖçÁöÑÁ©∫Èó¥Ôºå‰πüÂ∞±ÊòØ spawn ‰∏≠‰∏ÄÊ¨°ÊÄßÂàÜÈÖçÂú®Â†Ü‰∏äÁöÑÁ©∫Èó¥„ÄÇ</p>
<h3 id="3-1-Á¨¨‰∫å‰∏™ÈóÆÈ¢òÔºåËé∑Âèñ-amp-mut-Self"><a href="#3-1-Á¨¨‰∫å‰∏™ÈóÆÈ¢òÔºåËé∑Âèñ-amp-mut-Self" class="headerlink" title="3.1 Á¨¨‰∫å‰∏™ÈóÆÈ¢òÔºåËé∑Âèñ &amp;mut Self"></a>3.1 Á¨¨‰∫å‰∏™ÈóÆÈ¢òÔºåËé∑Âèñ &amp;mut Self</h3><p>ÈíàÂØπ async/await ÂæóÂà∞ÁöÑ <code>Pin&lt;&amp;mut Future&gt;</code>ÔºåPin ÂèØ‰ª•Á°Æ‰øù‰∏ç‰ºöÂú®ÂÆâÂÖ®‰ª£Á†Å‰∏≠ÂæóÂà∞ <code>&amp;mut Future</code>Ôºå‰ªéËÄåË¢´Êª•Áî®ÔºõÈíàÂØπÊâãÂä®ÂÆûÁé∞„ÄÅÊ≤°ÊúâËá™ÂºïÁî®ÁªìÊûÑÁöÑ„ÄÅÈù¢ÂêëÂ∫ïÂ±Ç reactor ÁöÑ FutureÔºåÂàôÂèØ‰ª•Ê≤°Êúâ‰ªª‰Ωï‰ª£‰ª∑Âú∞Ëé∑ÂèñÂà∞ <code>&amp;mut Future</code>„ÄÇ</p>
<p>ÈíàÂØπ executor Âíå reactorÔºåÊúâ‰∏§Áßç‰∏çÂêåÁöÑ FutureÔºåasync/await ÊòØ high-levelÔºåÈù¢Âêë executor ÁöÑ FutureÔºåÊâãÂä®ÂÆûÁé∞ÁöÑÊòØ low-levelÔºåÈù¢ÂêëÁ≥ªÁªüÁöÑ Future„ÄÇÂè™ÊúâÂâçËÄÖ‰ºöÂØºËá¥Ëá™ÂºïÁî®ÈóÆÈ¢òÔºå‰ΩÜÊòØ Rust Âõ¢ÈòüËä±‰∫ÜËøô‰πàÂ§öÁ≤æÂäõÂéª‰øÆË°•ÂÆåÂñÑÔºåËøôÊâçÊãøÂá∫‰∫ÜËøô‰∏™ÊØîËæÉÂ•ΩÁî®ÁöÑ APIÔºåÂ¶ÇÊûú‰∏ç‰∫ÜËß£Ëøô‰∫õÔºåÂÆåÂÖ®Ê≤°ÊúâÂäûÊ≥ïÊÉ≥Ë±°ÔºåÂ±ÖÁÑ∂ÊúâËøô‰πàÂ§öËÄÉÈáèÁöÑÂõ†Á¥†„ÄÇ</p>
</div><ul class="post-copyright"><li class="post-copyright-author"><strong>Post author: </strong>mem::swap(Rust, ü¶Ä )</li><li class="post-copyright-link"><strong>Post link: </strong><a href="https://hsqstephenzhang.github.io/2021/11/24/rust/future-explained3/" title="future explained(3)">https://hsqstephenzhang.github.io/2021/11/24/rust/future-explained3/</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> unless otherwise stated.</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2021/11/24/rust/future-explained2/" rel="prev" title="future explained(2)"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">future explained(2)</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2021/11/23/linux-tracing/index/" rel="next" title="linux tracing"><span class="post-nav-text">linux tracing</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>Ë¶Å‰∏çË¶ÅÂíåÊàëËØ¥‰∫õ‰ªÄ‰πàÔºü</span><br></div></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 ‚Äì 2022 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> mem::swap(Rust, ü¶Ä )</span></div><div class="powered"><span>Powered by <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> v5.4.0</span><span class="footer-separator">|</span><span>Theme - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.7.0</span></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a></div></body></html>